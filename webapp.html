<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Redirect</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
<script>
const tg = window.Telegram.WebApp;
tg.ready();

const params = new URLSearchParams(window.location.search);
const linkId = params.get("link");

fetch("/api/event", {
  method: "POST",
  headers: {"Content-Type": "application/json"},
  body: JSON.stringify({
    type: "scan",
    link_id: linkId,
    initData: tg.initData
  })
});

document.getElementById("open").onclick = () => {
  fetch("/api/event", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      type: "click",
      link_id: linkId,
      initData: tg.initData
    })
  });

  window.location.href = POST_URL;
};
</script>
</body>
</html>


